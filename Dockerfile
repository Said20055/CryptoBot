# Dockerfile

# Шаг 1: Базовый образ
# Используем легковесный и безопасный образ Alpine Linux с Python 3.9 (можно 3.11, как в вашем примере)
FROM python:3.11-slim-bookworm

# Шаг 2: Переменные окружения для Python
# PYTHONDONTWRITEBYTECODE=1: Не создавать .pyc файлы, они не нужны в контейнере.
# PYTHONUNBUFFERED=1: Выводить логи сразу в консоль, что критически важно для просмотра логов контейнера.
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Шаг 3: Установка рабочей директории
# Все последующие команды будут выполняться в этой папке внутри контейнера.
WORKDIR /usr/src/app

# Шаг 4: Установка зависимостей
# Обновляем pip до последней версии.
RUN pip install --upgrade pip
# Сначала копируем только файл с зависимостями. Docker закэширует этот слой.
COPY requirements.txt .
# Устанавливаем зависимости. Этот шаг будет выполнен заново только если изменится requirements.txt.
RUN pip install --no-cache-dir -r requirements.txt

# Шаг 5: Копирование кода приложения
# Копируем весь остальной код. Этот слой будет пересобираться при каждом изменении кода.
COPY . .

# Шаг 6: Команда для запуска
# Указываем, как запустить нашего бота.
CMD ["python", "main.py"]